doctype html
head
  title Add Receipt
  link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css')
  script.
    function handleCustomerSelection() {
    var customerSelect = document.getElementById("customer");
    var selectedCustomer = customerSelect.value;
    if (selectedCustomer === "newCustomer") {
    window.location.href = "/people/addcustomer";
    }
    }
  style.
    .column {
    float: left;
    width: 33.33%;
    padding: 10px;
    }
    .row:after {
    content: "";
    display: table;
    clear: both;
    }
    body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    }
    .row {
    margin-bottom: 20px;
    }
    .column {
    float: left;
    width: 33.33%;
    padding: 10px;
    box-sizing: border-box;
    }
    /* row1 */
    .row.custom-form {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    }
    .row.custom-form .column {
    flex: 1;
    padding: 10px;
    box-sizing: border-box;
    }
    .row.custom-form label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    }
    .row.custom-form input[type="text"],
    .row.custom-form input[type="number"],
    .row.custom-form input[type="date"] {
    width: 100%;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    }
    .row.custom-form .column.middle {
    margin: 0 10px;
    }
    .row.custom-form .column.address {
    margin-top: 20px;
    }
    .row.custom-form .column.address input[type="text"] {
    height: 60px;
    }
    /*  */
    label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"] {
    width: 100%;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    }
    table {
    width: 100%;
    border-collapse: collapse;
    }
    th,
    td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    }
    th {
    background-color: #f2f2f2;
    }
    button[type="submit"] {
    padding: 10px 20px;
    background-color: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    }
    .fa {
    cursor: pointer;
    margin-right: 5px;
    }
    .fa-trash {
    color: red;
    }
    /* cancel button */
    .cancel-button {
    padding: 10px 20px;
    background-color: #ccc;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    }
    .cancel-button:hover {
    background-color: #999;
    }
    /*  */


form(action='/commerce/addreciept' method='post')
  label(for='fname') First Name:
  input#fname(type='text' name='fname' oninput='handleCustomerNameInput()')
  datalist#customerNameSuggestions
  select#customerNameList(name='customerNameList' onchange='handleCustomerSelection()')
    option(value='addnewcustomer') Add New Customer
  br
  label(for='lname') Last Name:
  input#lname(type='text' name='lname')
  br
  label(for='shop') Shop:
  input#shop(type='text' name='shop')
  br
  label(for='phone') Phone:
  input#phone(type='text' name='phone')
  br
  label(for='tin') TIN:
  input#tin(type='text' name='tin')
  br
  label(for='sr') SR:
  input#sr(type='text' name='sr')
  br
  input(type='submit' value='Submit')

script.
  let customers = [];

  async function handleCustomerNameInput() {
    const customerNameInput = document.querySelector('#fname');
    const suggestionsList = document.querySelector('#customerNameSuggestions');
    const customerNameList = document.querySelector('#customerNameList');

    // Fetch suggestions from the server
    const response = await fetch(`/customers/search?q=${customerNameInput.value}`);
    customers = await response.json();

    // Clear the suggestions list and datalist
    suggestionsList.innerHTML = '';
    customerNameList.innerHTML = '';

    // Add the "Add New Customer" option to the select element
    const addNewCustomerOption = document.createElement('option');
    addNewCustomerOption.value = 'addnewcustomer';
    addNewCustomerOption.textContent = 'Add New Customer';
    customerNameList.appendChild(addNewCustomerOption);

    // Add the new suggestions to the datalist and select element
    for (const customer of customers) {
      const option = document.createElement('option');
      option.value = customer.fname;
      suggestionsList.appendChild(option);

      const selectOption = document.createElement('option');
      selectOption.value = customer.fname;
      selectOption.textContent = customer.fname;
      customerNameList.appendChild(selectOption);
    }
  }

  function handleCustomerSelection() {
    console.log('handleCustomerSelection called'); // Add this line
    const customerNameList = document.querySelector('#customerNameList');

    if (customerNameList.value === 'addnewcustomer') {
      window.location.href = '/addnewcustomer';
      return;
    }

    const selectedCustomer = customers.find(customer => customer.fname === customerNameList.value);

    if (selectedCustomer) {
      const lnameInput = document.querySelector('#lname');
      lnameInput.value = selectedCustomer.lname;

      const shopInput = document.querySelector('#shop');
      shopInput.value = selectedCustomer.shop;
    }
  }
